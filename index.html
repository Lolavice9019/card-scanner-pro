<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Scanner Pro</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://docs.opencv.org/4.5.0/opencv.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .app {
            min-height: 100vh;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
            position: relative;
        }
        
        .tab:hover {
            background: #ebebeb;
        }
        
        .tab.active {
            color: #667eea;
            background: white;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        
        .tab-content {
            padding: 30px;
            min-height: 500px;
        }
        
        .upload-zone {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 60px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9ff;
        }
        
        .upload-zone:hover {
            border-color: #764ba2;
            background: #f0f2ff;
        }
        
        .upload-zone.dragover {
            background: #e8eaff;
            border-color: #5a67d8;
        }
        
        .upload-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #667eea;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .btn-secondary:hover {
            background: #e8e8e8;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .image-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .image-box {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .image-box h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .image-box img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .image-placeholder {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            border-radius: 8px;
            color: #999;
            font-size: 1.1rem;
        }
        
        .ocr-results {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .ocr-text {
            min-height: 200px;
            padding: 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }
        
        .settings-group {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
        }
        
        .settings-group h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .setting-item label {
            font-weight: 500;
            color: #555;
        }
        
        .slider {
            width: 150px;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .batch-files {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            margin: 20px 0;
        }
        
        .batch-file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .batch-file-item.processing {
            background: #fff3cd;
        }
        
        .batch-file-item.completed {
            background: #d4edda;
        }
        
        .batch-file-item.error {
            background: #f8d7da;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-badge.pending { background: #e0e0e0; color: #666; }
        .status-badge.processing { background: #ffc107; color: #333; }
        .status-badge.completed { background: #28a745; color: white; }
        .status-badge.error { background: #dc3545; color: white; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            opacity: 0.9;
        }
        
        .hidden {
            display: none;
        }
        
        canvas {
            display: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect, useCallback } = React;
        
        // Image processing utilities
        class ImageProcessor {
            static detectCards(imageData, minArea = 10000) {
                const src = cv.matFromImageData(imageData);
                const gray = new cv.Mat();
                const blurred = new cv.Mat();
                const edges = new cv.Mat();
                
                cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY);
                cv.bilateralFilter(gray, blurred, 9, 75, 75);
                cv.Canny(blurred, edges, 30, 100);
                
                const contours = new cv.MatVector();
                const hierarchy = new cv.Mat();
                cv.findContours(edges, contours, hierarchy, cv.RETR_EXTERNAL, cv.CHAIN_APPROX_SIMPLE);
                
                const cards = [];
                for (let i = 0; i < contours.size(); i++) {
                    const contour = contours.get(i);
                    const area = cv.contourArea(contour);
                    
                    if (area >= minArea) {
                        const perimeter = cv.arcLength(contour, true);
                        const approx = new cv.Mat();
                        cv.approxPolyDP(contour, approx, 0.02 * perimeter, true);
                        
                        if (approx.rows === 4) {
                            cards.push(approx);
                        } else {
                            approx.delete();
                        }
                    }
                }
                
                // Cleanup
                src.delete();
                gray.delete();
                blurred.delete();
                edges.delete();
                contours.delete();
                hierarchy.delete();
                
                return cards;
            }
            
            static enhanceImage(imageData) {
                const src = cv.matFromImageData(imageData);
                const enhanced = new cv.Mat();
                const lab = new cv.Mat();
                
                // Bilateral filter for noise reduction
                cv.bilateralFilter(src, enhanced, 9, 75, 75);
                
                // Convert to LAB color space
                cv.cvtColor(enhanced, lab, cv.COLOR_RGBA2RGB);
                cv.cvtColor(lab, lab, cv.COLOR_RGB2Lab);
                
                // Split channels
                const channels = new cv.MatVector();
                cv.split(lab, channels);
                
                // Apply CLAHE to L channel
                const clahe = new cv.CLAHE(3.0, new cv.Size(8, 8));
                const lChannel = channels.get(0);
                clahe.apply(lChannel, lChannel);
                
                // Merge channels back
                cv.merge(channels, lab);
                cv.cvtColor(lab, enhanced, cv.COLOR_Lab2RGB);
                cv.cvtColor(enhanced, enhanced, cv.COLOR_RGB2RGBA);
                
                const result = new ImageData(
                    new Uint8ClampedArray(enhanced.data),
                    enhanced.cols,
                    enhanced.rows
                );
                
                // Cleanup
                src.delete();
                enhanced.delete();
                lab.delete();
                channels.delete();
                
                return result;
            }
            
            static warpPerspective(imageData, corners, width = 600, height = 400) {
                const src = cv.matFromImageData(imageData);
                const dst = new cv.Mat();
                
                // Define destination points
                const dstPoints = cv.matFromArray(4, 1, cv.CV_32FC2, [
                    0, 0,
                    width - 1, 0,
                    width - 1, height - 1,
                    0, height - 1
                ]);
                
                // Get transform matrix
                const M = cv.getPerspectiveTransform(corners, dstPoints);
                
                // Warp the image
                cv.warpPerspective(src, dst, M, new cv.Size(width, height));
                
                const result = new ImageData(
                    new Uint8ClampedArray(dst.data),
                    dst.cols,
                    dst.rows
                );
                
                // Cleanup
                src.delete();
                dst.delete();
                M.delete();
                dstPoints.delete();
                
                return result;
            }
        }
        
        // Main App Component
        function App() {
            const [activeTab, setActiveTab] = useState('scanner');
            const [originalImage, setOriginalImage] = useState(null);
            const [processedImage, setProcessedImage] = useState(null);
            const [isDragging, setIsDragging] = useState(false);
            const [processing, setProcessing] = useState(false);
            const [ocrText, setOcrText] = useState('');
            const [progress, setProgress] = useState(0);
            const [batchFiles, setBatchFiles] = useState([]);
            const [settings, setSettings] = useState({
                minArea: 10000,
                autoEnhance: true,
                autoRotate: true,
                extractText: false,
                cardWidth: 600,
                cardHeight: 400,
                claheClip: 3.0,
                bilateralD: 9,
                bilateralSigma: 75
            });
            
            const fileInputRef = useRef(null);
            const canvasRef = useRef(null);
            
            // Handle file upload
            const handleFileUpload = (files) => {
                if (files.length > 0) {
                    const file = files[0];
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = canvasRef.current;
                            canvas.width = img.width;
                            canvas.height = img.height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0);
                            const imageData = ctx.getImageData(0, 0, img.width, img.height);
                            setOriginalImage({
                                data: imageData,
                                url: e.target.result
                            });
                            setProcessedImage(null);
                            setOcrText('');
                        };
                        img.src = e.target.result;
                    };
                    
                    reader.readAsDataURL(file);
                }
            };
            
            // Handle drag and drop
            const handleDragOver = (e) => {
                e.preventDefault();
                setIsDragging(true);
            };
            
            const handleDragLeave = () => {
                setIsDragging(false);
            };
            
            const handleDrop = (e) => {
                e.preventDefault();
                setIsDragging(false);
                const files = Array.from(e.dataTransfer.files);
                handleFileUpload(files);
            };
            
            // Detect cards
            const detectCards = async () => {
                if (!originalImage) return;
                
                setProcessing(true);
                setProgress(25);
                
                setTimeout(() => {
                    try {
                        const cards = ImageProcessor.detectCards(originalImage.data, settings.minArea);
                        setProgress(50);
                        
                        if (cards.length > 0) {
                            // Process first card
                            const warped = ImageProcessor.warpPerspective(
                                originalImage.data,
                                cards[0],
                                settings.cardWidth,
                                settings.cardHeight
                            );
                            
                            setProgress(75);
                            
                            let finalImage = warped;
                            if (settings.autoEnhance) {
                                finalImage = ImageProcessor.enhanceImage(warped);
                            }
                            
                            // Convert to URL for display
                            const canvas = document.createElement('canvas');
                            canvas.width = finalImage.width;
                            canvas.height = finalImage.height;
                            const ctx = canvas.getContext('2d');
                            ctx.putImageData(finalImage, 0, 0);
                            
                            setProcessedImage({
                                data: finalImage,
                                url: canvas.toDataURL()
                            });
                            
                            setProgress(100);
                            
                            // Cleanup
                            cards.forEach(card => card.delete());
                        }
                    } catch (error) {
                        console.error('Detection error:', error);
                    }
                    
                    setProcessing(false);
                    setTimeout(() => setProgress(0), 500);
                }, 100);
            };
            
            // Enhance image
            const enhanceImage = () => {
                const imageToEnhance = processedImage || originalImage;
                if (!imageToEnhance) return;
                
                setProcessing(true);
                setProgress(50);
                
                setTimeout(() => {
                    try {
                        const enhanced = ImageProcessor.enhanceImage(imageToEnhance.data);
                        
                        const canvas = document.createElement('canvas');
                        canvas.width = enhanced.width;
                        canvas.height = enhanced.height;
                        const ctx = canvas.getContext('2d');
                        ctx.putImageData(enhanced, 0, 0);
                        
                        // Always set processedImage so save button works
                        setProcessedImage({
                            data: enhanced,
                            url: canvas.toDataURL()
                        });
                        
                        setProgress(100);
                    } catch (error) {
                        console.error('Enhancement error:', error);
                    }
                    
                    setProcessing(false);
                    setTimeout(() => setProgress(0), 500);
                }, 100);
            };
            
            // Perform OCR
            const performOCR = async () => {
                const imageToProcess = processedImage || originalImage;
                if (!imageToProcess) return;
                
                setProcessing(true);
                setProgress(25);
                
                try {
                    const worker = await Tesseract.createWorker('eng');
                    setProgress(50);
                    
                    const { data: { text } } = await worker.recognize(imageToProcess.url);
                    setProgress(75);
                    
                    setOcrText(text);
                    setActiveTab('ocr');
                    
                    await worker.terminate();
                    setProgress(100);
                } catch (error) {
                    console.error('OCR error:', error);
                }
                
                setProcessing(false);
                setTimeout(() => setProgress(0), 500);
            };
            
            // Save result
            const saveResult = () => {
                const imageToSave = processedImage || originalImage;
                if (!imageToSave) {
                    alert('Please upload an image first!');
                    return;
                }
                
                try {
                    const link = document.createElement('a');
                    link.download = `card_${Date.now()}.png`;
                    link.href = imageToSave.url;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    console.log('Image saved successfully');
                } catch (error) {
                    console.error('Save error:', error);
                    alert('Failed to save image. Please try again.');
                }
            };
            
            // Batch processing
            const handleBatchUpload = (files) => {
                const newFiles = Array.from(files).map((file, index) => ({
                    id: Date.now() + index,
                    file,
                    name: file.name,
                    status: 'pending',
                    progress: 0,
                    processedCards: [],
                    cardCount: 0
                }));
                setBatchFiles(prev => [...prev, ...newFiles]);
            };
            
            const processBatch = async () => {
                for (let i = 0; i < batchFiles.length; i++) {
                    if (batchFiles[i].status === 'pending') {
                        setBatchFiles(prev => prev.map((f, idx) => 
                            idx === i ? { ...f, status: 'processing', progress: 25 } : f
                        ));
                        
                        try {
                            const file = batchFiles[i].file;
                            const img = await new Promise((resolve, reject) => {
                                const reader = new FileReader();
                                reader.onload = (e) => {
                                    const image = new Image();
                                    image.onload = () => resolve(image);
                                    image.onerror = reject;
                                    image.src = e.target.result;
                                };
                                reader.onerror = reject;
                                reader.readAsDataURL(file);
                            });
                            
                            setBatchFiles(prev => prev.map((f, idx) => 
                                idx === i ? { ...f, progress: 50 } : f
                            ));
                            
                            const canvas = document.createElement('canvas');
                            canvas.width = img.width;
                            canvas.height = img.height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0);
                            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                            
                            // Detect cards
                            const src = cv.matFromImageData(imageData);
                            const cards = CardDetector.detectCards(src, settings);
                            
                            setBatchFiles(prev => prev.map((f, idx) => 
                                idx === i ? { ...f, progress: 75 } : f
                            ));
                            
                            const processedCards = [];
                            
                            for (let cardIdx = 0; cardIdx < cards.length; cardIdx++) {
                                const card = cards[cardIdx];
                                const enhanced = ImageProcessor.enhanceImage(card);
                                
                                const cardCanvas = document.createElement('canvas');
                                cardCanvas.width = enhanced.width;
                                cardCanvas.height = enhanced.height;
                                const cardCtx = cardCanvas.getContext('2d');
                                cardCtx.putImageData(enhanced, 0, 0);
                                
                                processedCards.push({
                                    id: `${batchFiles[i].id}_card_${cardIdx}`,
                                    url: cardCanvas.toDataURL(),
                                    index: cardIdx
                                });
                            }
                            
                            cards.forEach(card => card.delete());
                            src.delete();
                            
                            setBatchFiles(prev => prev.map((f, idx) => 
                                idx === i ? { 
                                    ...f, 
                                    status: 'completed', 
                                    progress: 100,
                                    processedCards,
                                    cardCount: processedCards.length
                                } : f
                            ));
                        } catch (error) {
                            console.error('Batch processing error:', error);
                            setBatchFiles(prev => prev.map((f, idx) => 
                                idx === i ? { ...f, status: 'error', progress: 0 } : f
                            ));
                        }
                    }
                }
            };
            
            const saveBatchCard = (fileId, cardId, cardUrl) => {
                const link = document.createElement('a');
                link.download = `card_${fileId}_${cardId}.png`;
                link.href = cardUrl;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };
            
            const downloadAllProcessed = () => {
                batchFiles.forEach(file => {
                    if (file.status === 'completed' && file.processedCards) {
                        file.processedCards.forEach(card => {
                            setTimeout(() => saveBatchCard(file.id, card.index, card.url), 100 * card.index);
                        });
                    }
                });
            };
            
            return (
                <div className="app">
                    <div className="header">
                        <h1>Card Scanner Pro</h1>
                        <p>Advanced Trading Card Enhancement & OCR Extraction</p>
                    </div>
                    
                    <div className="container">
                        <div className="tabs">
                            <button 
                                className={`tab ${activeTab === 'scanner' ? 'active' : ''}`}
                                onClick={() => setActiveTab('scanner')}
                            >
                                🎴 Scanner
                            </button>
                            <button 
                                className={`tab ${activeTab === 'batch' ? 'active' : ''}`}
                                onClick={() => setActiveTab('batch')}
                            >
                                📁 Batch Processing
                            </button>
                            <button 
                                className={`tab ${activeTab === 'ocr' ? 'active' : ''}`}
                                onClick={() => setActiveTab('ocr')}
                            >
                                📝 OCR Results
                            </button>
                            <button 
                                className={`tab ${activeTab === 'settings' ? 'active' : ''}`}
                                onClick={() => setActiveTab('settings')}
                            >
                                ⚙️ Settings
                            </button>
                        </div>
                        
                        <div className="tab-content">
                            {/* Scanner Tab */}
                            <div className={activeTab === 'scanner' ? '' : 'hidden'}>
                                {!originalImage ? (
                                    <div 
                                        className={`upload-zone ${isDragging ? 'dragover' : ''}`}
                                        onDragOver={handleDragOver}
                                        onDragLeave={handleDragLeave}
                                        onDrop={handleDrop}
                                        onClick={() => fileInputRef.current?.click()}
                                    >
                                        <div className="upload-icon">📤</div>
                                        <h3>Drag & Drop Card Image</h3>
                                        <p>or click to browse</p>
                                        <p style={{marginTop: '10px', opacity: 0.7}}>
                                            Supports PNG, JPG, JPEG, BMP
                                        </p>
                                        <input
                                            ref={fileInputRef}
                                            type="file"
                                            accept="image/*"
                                            onChange={(e) => handleFileUpload(e.target.files)}
                                            style={{display: 'none'}}
                                        />
                                    </div>
                                ) : (
                                    <>
                                        <div className="controls">
                                            <button 
                                                className="btn btn-primary"
                                                onClick={detectCards}
                                                disabled={processing}
                                            >
                                                🔍 Detect Cards
                                            </button>
                                            <button 
                                                className="btn btn-primary"
                                                onClick={enhanceImage}
                                                disabled={processing}
                                            >
                                                ✨ Enhance
                                            </button>
                                            <button 
                                                className="btn btn-primary"
                                                onClick={performOCR}
                                                disabled={processing}
                                            >
                                                📖 Extract Text
                                            </button>
                                            <button 
                                                className="btn btn-secondary"
                                                onClick={saveResult}
                                                disabled={!originalImage}
                                            >
                                                💾 Save Result
                                            </button>
                                            <button 
                                                className="btn btn-secondary"
                                                onClick={() => {
                                                    setOriginalImage(null);
                                                    setProcessedImage(null);
                                                    setOcrText('');
                                                }}
                                            >
                                                🔄 Reset
                                            </button>
                                        </div>
                                        
                                        {progress > 0 && (
                                            <div className="progress-bar">
                                                <div 
                                                    className="progress-fill"
                                                    style={{width: `${progress}%`}}
                                                >
                                                    {progress}%
                                                </div>
                                            </div>
                                        )}
                                        
                                        <div className="image-container">
                                            <div className="image-box">
                                                <h3>Original Image</h3>
                                                {originalImage ? (
                                                    <img src={originalImage.url} alt="Original" />
                                                ) : (
                                                    <div className="image-placeholder">
                                                        No image loaded
                                                    </div>
                                                )}
                                            </div>
                                            <div className="image-box">
                                                <h3>Processed Image</h3>
                                                {processedImage ? (
                                                    <img src={processedImage.url} alt="Processed" />
                                                ) : (
                                                    <div className="image-placeholder">
                                                        No processed image
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </>
                                )}
                            </div>
                            
                            {/* Batch Processing Tab */}
                            <div className={activeTab === 'batch' ? '' : 'hidden'}>
                                <div className="controls">
                                    <button 
                                        className="btn btn-primary"
                                        onClick={() => {
                                            const input = document.createElement('input');
                                            input.type = 'file';
                                            input.multiple = true;
                                            input.accept = 'image/*';
                                            input.onchange = (e) => handleBatchUpload(e.target.files);
                                            input.click();
                                        }}
                                    >
                                        ➕ Add Images
                                    </button>
                                    <button 
                                        className="btn btn-primary"
                                        onClick={processBatch}
                                        disabled={batchFiles.length === 0}
                                    >
                                        ▶️ Process Batch
                                    </button>
                                    <button 
                                        className="btn btn-secondary"
                                        onClick={() => setBatchFiles([])}
                                    >
                                        🗑️ Clear All
                                    </button>
                                </div>
                                
                                <div className="stats-grid">
                                    <div className="stat-card">
                                        <div className="stat-value">{batchFiles.length}</div>
                                        <div className="stat-label">Total Files</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-value">
                                            {batchFiles.filter(f => f.status === 'completed').length}
                                        </div>
                                        <div className="stat-label">Completed</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-value">
                                            {batchFiles.filter(f => f.status === 'processing').length}
                                        </div>
                                        <div className="stat-label">Processing</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-value">
                                            {batchFiles.filter(f => f.status === 'pending').length}
                                        </div>
                                        <div className="stat-label">Pending</div>
                                    </div>
                                </div>
                                
                                <div className="batch-files">
                                    {batchFiles.length === 0 ? (
                                        <div style={{textAlign: 'center', padding: '40px'}}>
                                            <p style={{color: '#999', marginBottom: '20px'}}>
                                                No files added yet. Click "Add Images" to begin.
                                            </p>
                                            <div style={{background: '#f0f8ff', padding: '20px', borderRadius: '8px', textAlign: 'left', maxWidth: '600px', margin: '0 auto'}}>
                                                <h4 style={{marginBottom: '10px'}}>📋 What Batch Processing Does:</h4>
                                                <ul style={{lineHeight: '1.8'}}>
                                                    <li>✅ Automatically detects and crops cards from each image</li>
                                                    <li>✅ Applies perspective correction for clean extraction</li>
                                                    <li>✅ Enhances each card with filters and sharpening</li>
                                                    <li>✅ Saves each card individually or download all at once</li>
                                                </ul>
                                            </div>
                                        </div>
                                    ) : (
                                        <>
                                            <div style={{marginBottom: '20px', display: 'flex', gap: '10px', justifyContent: 'flex-end'}}>
                                                <button 
                                                    className="btn btn-primary"
                                                    onClick={downloadAllProcessed}
                                                    disabled={!batchFiles.some(f => f.status === 'completed')}
                                                >
                                                    📥 Download All Processed
                                                </button>
                                            </div>
                                            {batchFiles.map(file => (
                                                <div 
                                                    key={file.id} 
                                                    className={`batch-file-item ${file.status}`}
                                                    style={{flexDirection: 'column', alignItems: 'flex-start'}}
                                                >
                                                    <div style={{display: 'flex', justifyContent: 'space-between', width: '100%', marginBottom: '10px'}}>
                                                        <span><strong>{file.name}</strong></span>
                                                        <span className={`status-badge ${file.status}`}>
                                                            {file.status === 'completed' ? `✓ ${file.cardCount} card(s) detected` : file.status}
                                                        </span>
                                                    </div>
                                                    {file.status === 'processing' && (
                                                        <div className="progress-bar" style={{width: '100%', margin: '10px 0'}}>
                                                            <div className="progress-fill" style={{width: `${file.progress}%`}}>
                                                                {file.progress}%
                                                            </div>
                                                        </div>
                                                    )}
                                                    {file.status === 'completed' && file.processedCards && file.processedCards.length > 0 && (
                                                        <div style={{display: 'flex', gap: '15px', flexWrap: 'wrap', marginTop: '10px', width: '100%'}}>
                                                            {file.processedCards.map(card => (
                                                                <div key={card.id} style={{textAlign: 'center'}}>
                                                                    <img 
                                                                        src={card.url} 
                                                                        alt={`Card ${card.index + 1}`}
                                                                        style={{width: '120px', height: 'auto', borderRadius: '5px', boxShadow: '0 2px 8px rgba(0,0,0,0.2)', marginBottom: '8px'}}
                                                                    />
                                                                    <br/>
                                                                    <button 
                                                                        className="btn btn-secondary"
                                                                        style={{fontSize: '0.85rem', padding: '6px 12px'}}
                                                                        onClick={() => saveBatchCard(file.id, card.index, card.url)}
                                                                    >
                                                                        💾 Save
                                                                    </button>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}
                                                    {file.status === 'error' && (
                                                        <p style={{color: '#dc3545', marginTop: '5px'}}>❌ Failed to process this image</p>
                                                    )}
                                                </div>
                                            ))}
                                        </>
                                    )}
                                </div>
                            </div>
                            
                            {/* OCR Results Tab */}
                            <div className={activeTab === 'ocr' ? '' : 'hidden'}>
                                <div className="ocr-results">
                                    <h3>Extracted Text</h3>
                                    <div className="ocr-text">
                                        {ocrText || 'No text extracted yet. Process an image and click "Extract Text" to see results.'}
                                    </div>
                                    <div className="controls" style={{marginTop: '20px'}}>
                                        <button 
                                            className="btn btn-secondary"
                                            onClick={() => {
                                                if (ocrText) {
                                                    navigator.clipboard.writeText(ocrText);
                                                    alert('Text copied to clipboard!');
                                                }
                                            }}
                                            disabled={!ocrText}
                                        >
                                            📋 Copy Text
                                        </button>
                                        <button 
                                            className="btn btn-secondary"
                                            onClick={() => {
                                                if (ocrText) {
                                                    const blob = new Blob([ocrText], {type: 'text/plain'});
                                                    const url = URL.createObjectURL(blob);
                                                    const link = document.createElement('a');
                                                    link.download = 'extracted_text.txt';
                                                    link.href = url;
                                                    link.click();
                                                }
                                            }}
                                            disabled={!ocrText}
                                        >
                                            💾 Save as TXT
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            {/* Settings Tab */}
                            <div className={activeTab === 'settings' ? '' : 'hidden'}>
                                <div className="settings-grid">
                                    <div className="settings-group">
                                        <h3>Detection Settings</h3>
                                        <div className="setting-item">
                                            <label>Min Card Area: {settings.minArea}</label>
                                            <input 
                                                type="range"
                                                className="slider"
                                                min="1000"
                                                max="50000"
                                                value={settings.minArea}
                                                onChange={(e) => setSettings({
                                                    ...settings, 
                                                    minArea: parseInt(e.target.value)
                                                })}
                                            />
                                        </div>
                                        <div className="setting-item">
                                            <label>Auto-enhance</label>
                                            <input 
                                                type="checkbox"
                                                className="checkbox"
                                                checked={settings.autoEnhance}
                                                onChange={(e) => setSettings({
                                                    ...settings, 
                                                    autoEnhance: e.target.checked
                                                })}
                                            />
                                        </div>
                                        <div className="setting-item">
                                            <label>Auto-rotate</label>
                                            <input 
                                                type="checkbox"
                                                className="checkbox"
                                                checked={settings.autoRotate}
                                                onChange={(e) => setSettings({
                                                    ...settings, 
                                                    autoRotate: e.target.checked
                                                })}
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="settings-group">
                                        <h3>Enhancement Settings</h3>
                                        <div className="setting-item">
                                            <label>CLAHE Clip: {settings.claheClip}</label>
                                            <input 
                                                type="range"
                                                className="slider"
                                                min="1"
                                                max="10"
                                                step="0.5"
                                                value={settings.claheClip}
                                                onChange={(e) => setSettings({
                                                    ...settings, 
                                                    claheClip: parseFloat(e.target.value)
                                                })}
                                            />
                                        </div>
                                        <div className="setting-item">
                                            <label>Bilateral D: {settings.bilateralD}</label>
                                            <input 
                                                type="range"
                                                className="slider"
                                                min="5"
                                                max="15"
                                                value={settings.bilateralD}
                                                onChange={(e) => setSettings({
                                                    ...settings, 
                                                    bilateralD: parseInt(e.target.value)
                                                })}
                                            />
                                        </div>
                                        <div className="setting-item">
                                            <label>Bilateral Sigma: {settings.bilateralSigma}</label>
                                            <input 
                                                type="range"
                                                className="slider"
                                                min="10"
                                                max="150"
                                                value={settings.bilateralSigma}
                                                onChange={(e) => setSettings({
                                                    ...settings, 
                                                    bilateralSigma: parseInt(e.target.value)
                                                })}
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="settings-group">
                                        <h3>Output Settings</h3>
                                        <div className="setting-item">
                                            <label>Card Width: {settings.cardWidth}px</label>
                                            <input 
                                                type="range"
                                                className="slider"
                                                min="200"
                                                max="1200"
                                                step="50"
                                                value={settings.cardWidth}
                                                onChange={(e) => setSettings({
                                                    ...settings, 
                                                    cardWidth: parseInt(e.target.value)
                                                })}
                                            />
                                        </div>
                                        <div className="setting-item">
                                            <label>Card Height: {settings.cardHeight}px</label>
                                            <input 
                                                type="range"
                                                className="slider"
                                                min="200"
                                                max="1200"
                                                step="50"
                                                value={settings.cardHeight}
                                                onChange={(e) => setSettings({
                                                    ...settings, 
                                                    cardHeight: parseInt(e.target.value)
                                                })}
                                            />
                                        </div>
                                        <div className="setting-item">
                                            <label>Extract text on detection</label>
                                            <input 
                                                type="checkbox"
                                                className="checkbox"
                                                checked={settings.extractText}
                                                onChange={(e) => setSettings({
                                                    ...settings, 
                                                    extractText: e.target.checked
                                                })}
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="settings-group">
                                        <h3>About</h3>
                                        <p style={{color: '#666', lineHeight: '1.6'}}>
                                            Card Scanner Pro v1.0<br/>
                                            Built with React, OpenCV.js, and Tesseract.js<br/>
                                            <br/>
                                            Optimized for sports and trading cards.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <canvas ref={canvasRef}></canvas>
                </div>
            );
        }
        
        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>